<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Church Trivia</title>
    
    <!-- Favicon (Simple Cross/Trophy Icon) -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>✝</text></svg>">
    
    <!-- React and ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body {
            background-color: #1a202c;
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .animate-pop {
            animation: pop 0.3s ease-out;
        }
        @keyframes pop {
            0% { transform: scale(0.9); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        .animate-slide {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            0% { transform: translateY(20px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }
        .shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }
        .timer-bar {
            transition: width 1s linear, background-color 1s linear;
        }
        .animate-winner {
            animation: winnerScale 1s infinite alternate;
        }
        @keyframes winnerScale {
            0% { transform: scale(1); box-shadow: 0 0 15px rgba(255, 215, 0, 0.5); }
            100% { transform: scale(1.05); box-shadow: 0 0 30px rgba(255, 215, 0, 0.9); }
        }
    </style>
</head>
<body>

<div id="root"></div>

<script type="text/babel">

    // --- DATA ---
    const RAW_QUESTIONS = [
        // SCRIPTURE MASTERY (20 POINTS EACH - 20 QUESTIONS)
        { id: 1, Category: "Scripture Mastery", Question: "In Moroni 10:4, we are exhorted to ask God if these things are not true. What specific title for God is used in this verse?", A: "Eternal Father", B: "Almighty God", C: "Lord of Hosts", D: "Creator of All", Correct: "A", Points: 20 },
        { id: 2, Category: "Scripture Mastery", Question: "According to 1 Nephi 17:5, the land Bountiful was named 'Bountiful' specifically because of what resource?", A: "Gold and Silver", B: "Much fruit and wild honey", C: "Abundant timber", D: "Fresh water springs", Correct: "B", Points: 20 },
        { id: 3, Category: "Scripture Mastery", Question: "According to Article of Faith 10, what specific thing will be 'renewed and receive its paradisiacal glory'?", A: "The Heavens", B: "The Earth", C: "The Temple", D: "The Spirit World", Correct: "B", Points: 20 },
        { id: 4, Category: "Scripture Mastery", Question: "In the 'Testimony of the Three Witnesses', they declare they heard whose voice commanding them to bear record of the plates?", A: "The voice of an Angel", B: "The voice of God", C: "The voice of Joseph", D: "The voice of Moroni", Correct: "B", Points: 20 },
        { id: 5, Category: "Scripture Mastery", Question: "In 2 Nephi 2, Lehi teaches about opposition. Which specific verse contains the phrase 'Adam fell that men might be'?", A: "Verse 22", B: "Verse 23", C: "Verse 25", D: "Verse 27", Correct: "C", Points: 20 },
        { id: 6, Category: "Scripture Mastery", Question: "In Alma 37:38, Alma refers to the Liahona by what other specific descriptive name?", A: "The Compass", B: "The Dictator", C: "The Guide", D: "The Pointer", Correct: "A", Points: 20 },
        { id: 7, Category: "Scripture Mastery", Question: "In D&C 4:2, serving with 'all your heart, might, mind and strength' ensures you stand how before God at the last day?", A: "Forgiven", B: "Blameless", C: "Exalted", D: "Justified", Correct: "B", Points: 20 },
        { id: 8, Category: "Scripture Mastery", Question: "What is the very last word of the Old Testament (Malachi 4:6)?", A: "Amen", B: "Earth", C: "Curse", D: "Destruction", Correct: "C", Points: 20 },
        { id: 30, Category: "Scripture Mastery", Question: "\"For behold, this life is the time for men to prepare to meet God.\" Which verse from Alma contains this pivotal statement?", A: "Alma 32:21", B: "Alma 34:11", C: "Alma 33:2", D: "Alma 34:32", Correct: "D", Points: 20 },
        { id: 31, Category: "Scripture Mastery", Question: "What is the specific word used in 3 Nephi 12:48 describing the type of men we should be?", A: "Righteous", B: "Perfect", C: "Holy", D: "Pure", Correct: "B", Points: 20 },
        { id: 32, Category: "Scripture Mastery", Question: "What does the Lord ask us to \"cease to be\" in D&C 88:123?", A: "Quick to anger", B: "Prideful", C: "Covetous", D: "Contentious", Correct: "C", Points: 20 },
        { id: 33, Category: "Scripture Mastery", Question: "In 1 Nephi 6:2, who does it say Nephi is a descendent of?", A: "Joshua", B: "Jethro", C: "Jeremiah", D: "Joseph", Correct: "D", Points: 20 },
        { id: 34, Category: "Scripture Mastery", Question: "According to Moroni 7:45, charity includes two specific actions: suffering long and what else?", A: "Is kind", B: "Is humble", C: "Is patient", D: "Is generous", Correct: "A", Points: 20 },
        { id: 35, Category: "Scripture Mastery", Question: "In Ether 12:27, the Lord promises to make weak things what?", A: "Useful", B: "Whole", C: "Mighty", D: "Strong", Correct: "D", Points: 20 },
        { id: 36, Category: "Scripture Mastery", Question: "Which book and chapter contains the account of the conversion of Alma the Younger?", A: "Alma 5", B: "Mosiah 27", C: "Mosiah 28", D: "Alma 36", Correct: "B", Points: 20 },
        { id: 37, Category: "Scripture Mastery", Question: "What specific phrase is found in D&C 1:38 about the voice of the Lord's servants?", A: "A powerful voice", B: "The voice of truth", C: "The same as his own voice", D: "A small voice", Correct: "C", Points: 20 },
        { id: 38, Category: "Scripture Mastery", Question: "According to Moses 1:39, what is the Lord's work and glory?", A: "To bring to pass the immortality and eternal life of man", B: "To rule over the earth", C: "To create worlds", D: "To establish Zion", Correct: "A", Points: 20 },
        { id: 39, Category: "Scripture Mastery", Question: "What did Joseph Smith ask of the Lord in James 1:5, which led to the First Vision?", A: "Forgiveness", B: "Riches", C: "Wisdom", D: "Strength", Correct: "C", Points: 20 },
        { id: 40, Category: "Scripture Mastery", Question: "In Doctrine and Covenants 88:119, what specific structure is mentioned that we should establish?", A: "A house of prayer", B: "A sanctuary", C: "A school of the prophets", D: "A place of refuge", Correct: "A", Points: 20 },
        { id: 41, Category: "Scripture Mastery", Question: "Which verse in the New Testament declares, \"If any of you lack wisdom, let him ask of God...\"?", A: "Matthew 5:16", B: "Acts 1:8", C: "John 14:6", D: "James 1:5", Correct: "D", Points: 20 },


        // POP CULTURE (10 POINTS EACH - 20 QUESTIONS)
        { id: 15, Category: "Pop Culture", Question: "In 'Spider-Man: No Way Home', which university rejects MJ and Ned?", A: "Empire State University", B: "MIT", C: "Columbia", D: "NYU", Correct: "B", Points: 10 },
        { id: 16, Category: "Pop Culture", Question: "In 'Harry Potter', what is the core of the Elder Wand?", A: "Phoenix Feather", B: "Dragon Heartstring", C: "Thestral Tail Hair", D: "Unicorn Hair", Correct: "C", Points: 10 },
        { id: 17, Category: "Pop Culture", Question: "How many 'Album of the Year' Grammys had Taylor Swift won as of 2024?", A: "2", B: "3", C: "4", D: "5", Correct: "C", Points: 10 },
        { id: 18, Category: "Pop Culture", Question: "What's the name of the actor who played Peter Quill in Guardians of the Galaxy?", A: "Chris Pratt", B: "Chris Hemsworth", C: "Chris Evans", D: "Cristiano Ronaldo", Correct: "A", Points: 10 },
        { id: 19, Category: "Pop Culture", Question: "In 'Frozen II', what is the name of the Fire Spirit (the salamander)?", A: "Bruni", B: "Gale", C: "Nokk", D: "Igni", Correct: "A", Points: 10 },
        { id: 20, Category: "Pop Culture", Question: "In Minecraft, what item do you need to combine with Netherite Scraps to make a Netherite Ingot?", A: "Diamond", B: "Gold Ingot", C: "Iron Ingot", D: "Obsidian", Correct: "B", Points: 10 },
        { id: 21, Category: "Pop Culture", Question: "What is the real name of The Mandalorian (Mando)?", A: "Din Djarin", B: "Boba Fett", C: "Jango Fett", D: "Paz Vizsla", Correct: "A", Points: 10 },
        { id: 42, Category: "Pop Culture", Question: "What is the highest rank in the League of Legends competitive ladder?", A: "Grandmaster", B: "Challenger", C: "Diamond", D: "Immortal", Correct: "B", Points: 10 },
        { id: 43, Category: "Pop Culture", Question: "In the TV show 'The Office', what is Dwight Schrute's secondary job title, besides salesman?", A: "Regional Manager", B: "Assistant Regional Manager", C: "Assistant to the Regional Manager", D: "Safety Coordinator", Correct: "C", Points: 10 },
        { id: 44, Category: "Pop Culture", Question: "Which Pixar film features a character named Edna Mode?", A: "The Incredibles", B: "Coco", C: "Toy Story 3", D: "Ratatouille", Correct: "A", Points: 10 },
        { id: 45, Category: "Pop Culture", Question: "What's the name of Thor's hamer?", A: "Odin's Mallet", B: "Thunderclap", C: "Hammerstein", D: "Mjolnir", Correct: "D", Points: 10 },
        { id: 46, Category: "Pop Culture", Question: "What year was the first iPhone released?", A: "2005", B: "2007", C: "2008", D: "2006", Correct: "B", Points: 10 },
        { id: 47, Category: "Pop Culture", Question: "What's the name of the boy who destroys toys in Toy Story 1?", A: "Andy", B: "Bud", C: "Sid", D: "Carlos", Correct: "C", Points: 10 },
        { id: 48, Category: "Pop Culture", Question: "In the Marvel Cinematic Universe, what planet did the Guardians of the Galaxy originally save?", A: "Earth", B: "Titan", C: "Xandar", D: "Knowhere", Correct: "C", Points: 10 },
        { id: 49, Category: "Pop Culture", Question: "What type of animal is Spongebob SquarePants' pet Gary?", A: "Cat", B: "Worm", C: "Snail", D: "Slug", Correct: "C", Points: 10 },
        { id: 50, Category: "Pop Culture", Question: "In the movie K-Pop Demon Hunters, what is the name of the k-pop girl group that secretly fights demons?", A: "Huntrix", B: "Sajan Queens", C: "Demon Divas", D: "K-Slay", Correct: "A", Points: 10 },
        { id: 51, Category: "Pop Culture", Question: "What color is the Master Sword in 'The Legend of Zelda'?", A: "Blue", B: "Red", C: "Green", D: "Gold", Correct: "A", Points: 10 },
        { id: 52, Category: "Pop Culture", Question: "In what year was DineyLand opened?", A: "1945", B: "1965", C: "1955", D: "1975", Correct: "C", Points: 10 },
        { id: 53, Category: "Pop Culture", Question: "What food item is often used to craft an Enchanted Golden Apple in Minecraft?", A: "Gold Ingots", B: "Gold Nuggets", C: "Diamonds", D: "Gold Blocks", Correct: "D", Points: 10 },
        { id: 54, Category: "Pop Culture", Question: "Who directed the movies 'Inception' and 'The Dark Night'?", A: "Steven Spielberg", B: "Christopher Nolan", C: "Quentin Tarantino", D: "Denis Villeneuve", Correct: "B", Points: 10 },
        { id: 88, Category: "Pop Culture", Question: "6 7???", A: "67!!", B: "6 7", C: "six seven", D: "roku nana", Correct: "B", Points: 6.7 },


        // MISSION PREP (20 POINTS EACH - 20 QUESTIONS)
        { id: 23, Category: "Mission Prep", Question: "In what year was the missionary age lowered to 18 for men and 19 for women?", A: "2010", B: "2012", C: "2014", D: "2011", Correct: "B", Points: 20 },
        { id: 24, Category: "Mission Prep", Question: "What is the full subtitle of the manual 'Preach My Gospel'?", A: "A Guide to Missionary Service", B: "A Guide to Sharing the Gospel of Jesus Christ", C: "The Missionary Handbook", D: "Instructions for God's Army", Correct: "B", Points: 20 },
        { id: 25, Category: "Mission Prep", Question: "Which chapter of Preach My Gospel focuses on 'How Do I Recognize and Understand the Spirit'?", A: "Chapter 3", B: "Chapter 4", C: "Chapter 5", D: "Chapter 2", Correct: "B", Points: 20 },
        { id: 55, Category: "Mission Prep", Question: "According to 'Preach My Gospel', Chapter 1, what is the primary purpose of missionary work?", A: "Baptize many people", B: "Memorize the discussions", C: "Invite others to come unto Christ", D: "Serve the community", Correct: "C", Points: 20 },
        { id: 56, Category: "Mission Prep", Question: "In which of these places is there NOT an MTC (Missionary Training Center?", A: "New Zealand", B: "Japan", C: "Provo, Utah", D: "Ghana", Correct: "B", Points: 20 },
        { id: 57, Category: "Mission Prep", Question: "How early before your availability date can you start filling out your missionary paperwork??", A: "30 days", B: "1 year", C: "90 days", D: "6 months", Correct: "D", Points: 20 },
        { id: 58, Category: "Mission Prep", Question: "What is the minimal required time commitment for studying 'Preach My Gospel' daily, according to the suggested schedule?", A: "15 minutes", B: "20 minutes", C: "30 minutes", D: "60 minutes", Correct: "C", Points: 20 },
        { id: 59, Category: "Mission Prep", Question: "Which section of the Doctrine and Covenants outlines the qualifications for missionary work (e.g., \"faith, hope, charity, and love\")?", A: "D&C 4", B: "D&C 12", C: "D&C 88", D: "D&C 133", Correct: "A", Points: 20 },
        { id: 60, Category: "Mission Prep", Question: "What is the name of the official system used by missionaries to track and coordinate appointments and contacts?", A: "Missionary Planner", B: "Area Book", C: "Missionary Tracker", D: "Zone Locator", Correct: "B", Points: 20 },
        { id: 61, Category: "Mission Prep", Question: "When is the earliest a young man can receive the Melchizedek Priesthood?", A: "When they turn 18", B: "One month before mission", C: "When they turn 19", D: "On the first day of the MTC", Correct: "A", Points: 20 },
        { id: 62, Category: "Mission Prep", Question: "Which lesson in Chapter 3 of 'Preach My Gospel' covers the principles of the Gospel of Jesus Christ (Faith, Repentance, Baptism, Holy Ghost)?", A: "Lesson 2", B: "Lesson 3", C: "Lesson 4", D: "Lesson 5", Correct: "B", Points: 20 },
        { id: 63, Category: "Mission Prep", Question: "Which chapter in 'Preach My Gospel' specifically deals with finding people to teach?", A: "Chapter 6", B: "Chapter 7", C: "Chapter 9", D: "Chapter 11", Correct: "C", Points: 20 },
        { id: 64, Category: "Mission Prep", Question: "What is the final step in the baptismal interview before the baptism itself?", A: "Committing to receive the gift of the Holy Ghost", B: "Confirming their testimony", C: "Signing the paperwork", D: "Getting dressed in whites", Correct: "A", Points: 20 },
        { id: 65, Category: "Mission Prep", Question: "What is the general time when proselyting ends in most missions, as dictated by handbook policy?", A: "8:00 PM", B: "9:00 PM", C: "10:00 PM", D: "Varies by Mission President", Correct: "B", Points: 20 },
        { id: 66, Category: "Mission Prep", Question: "What specific physical activity is required for missionaries to engage in daily for at least 30 minutes?", A: "Reading", B: "Writing", C: "Exercise", D: "Singing", Correct: "C", Points: 20 },
        { id: 67, Category: "Mission Prep", Question: "How much is the standard monthly payment for a missionary?", A: "$500", B: "$800", C: "$100", D: "$400", Correct: "D", Points: 20 },
        { id: 68, Category: "Mission Prep", Question: "Who holds the keys of missionary work?", A: "Quorum of the Twelve", B: "President of the Church", C: "Mission Presidents", D: "Area Authority", Correct: "B", Points: 20 },
        { id: 69, Category: "Mission Prep", Question: "What is the name of the meeting held (normally) every Tuesday morning for missionaries to coordinate work and receive training?", A: "Zone Conference", B: "Missionary Meeting", C: "District Council", D: "Companion Study", Correct: "C", Points: 20 },
        { id: 70, Category: "Mission Prep", Question: "Missionaries are taught to teach according to the needs of the investigator and what else?", A: "The Spirit", B: "The Bishop", C: "The Manual", D: "The Zone Leaders", Correct: "A", Points: 20 },
        { id: 71, Category: "Mission Prep", Question: "What color shirt is generally approved for male missionaries in most areas?", A: "Green", B: "Gray", C: "Light Yellow", D: "White", Correct: "D", Points: 20 },


        // CHURCH HISTORY (20 POINTS EACH - 20 QUESTIONS - Made easier)
        { id: 26, Category: "Church History", Question: "In what state did Joseph Smith see the First Vision and the angel Moroni?", A: "Ohio", B: "Missouri", C: "New York", D: "Illinois", Correct: "C", Points: 20 },
        { id: 27, Category: "Church History", Question: "Who appeared to Joseph Smith and Oliver Cowdery to restore the Aaronic Priesthood?", A: "Peter, James, and John", B: "John the Baptist", C: "Elijah", D: "Moroni", Correct: "B", Points: 20 },
        { id: 28, Category: "Church History", Question: "Who led the Saints west on the pioneer trek to the Salt Lake Valley?", A: "Joseph Smith", B: "John Taylor", C: "Brigham Young", D: "Wilford Woodruff", Correct: "C", Points: 20 },
        { id: 29, Category: "Church History", Question: "In which city were Joseph Smith and his brother Hyrum martyred?", A: "Nauvoo, Illinois", B: "Kirtland, Ohio", C: "Carthage, Illinois", D: "Independence, Missouri", Correct: "C", Points: 20 },
        { id: 72, Category: "Church History", Question: "In what year did the Saints first enter the Salt Lake Valley?", A: "1846", B: "1847", C: "1850", D: "1849", Correct: "B", Points: 20 },
        { id: 73, Category: "Church History", Question: "Which famous group of pioneers used handcarts for transportation in their journey west?", A: "The Mormon Battalion", B: "The Handcart Companies", C: "Zion's Camp", D: "The Vanguard Company", Correct: "B", Points: 20 },
        { id: 74, Category: "Church History", Question: "The Saints were gathered in Nauvoo, Illinois, near which large river?", A: "Missouri River", B: "Mississippi River", C: "Ohio River", D: "Columbia River", Correct: "B", Points: 20 },
        { id: 75, Category: "Church History", Question: "Which city was the site of the first temple built in this dispensation?", A: "Nauvoo", B: "Salt Lake City", C: "Kirtland", D: "Logan", Correct: "C", Points: 20 },
        { id: 76, Category: "Church History", Question: "What is the name of the organization for women that was established in Nauvoo in 1842?", A: "Young Women", B: "Primary", C: "Relief Society", D: "Daughters of the Covenant", Correct: "C", Points: 20 },
        { id: 77, Category: "Church History", Question: "Who served as the primary scribe for Joseph Smith during the translation of the majority of the Book of Mormon?", A: "Martin Harris", B: "Emma Smith", C: "Sidney Rigdon", D: "Oliver Cowdery", Correct: "D", Points: 20 },
        { id: 78, Category: "Church History", Question: "Which prophet received the revelation known as Official Declaration 2, ending the restriction on Priesthood and Temple blessings based on race?", A: "David O. McKay", B: "Spencer W. Kimball", C: "Ezra Taft Benson", D: "Joseph Fielding Smith", Correct: "B", Points: 20 },
        { id: 79, Category: "Church History", Question: "What event occurred in 1820 that began the Restoration of the Church?", A: "The Book of Mormon was published", B: "The First Vision", C: "The Church was organized", D: "The Melchizedek Priesthood was restored", Correct: "B", Points: 20 },
        { id: 80, Category: "Church History", Question: "Before settling in Nauvoo, the Saints attempted to gather in which state, leading to heavy persecution?", A: "Pennsylvania", B: "Missouri", C: "Iowa", D: "Texas", Correct: "B", Points: 20 },
        { id: 81, Category: "Church History", Question: "In the Salt Lake Valley, what notable building was the central focus of the city for many years?", A: "City Hall", B: "The Assembly Hall", C: "The Salt Lake Temple", D: "The Tabernacle", Correct: "C", Points: 20 },
        { id: 82, Category: "Church History", Question: "What document did Joseph Smith ask the Lord for wisdom about, leading to the First Vision?", A: "The Book of Mormon", B: "The Bible (James 1:5)", C: "The Articles of Faith", D: "The Doctrine and Covenants", Correct: "B", Points: 20 },
        { id: 83, Category: "Church History", Question: "What was the Church's main gathering place and first headquarters in Ohio?", A: "Hiram", B: "Nauvoo", C: "Fayette", D: "Kirtland", Correct: "D", Points: 20 },
        { id: 84, Category: "Church History", Question: "Joseph Smith described the Book of Mormon as the 'keystone of our religion' and the what else?", A: "Most sacred text", B: "Most correct book", C: "Greatest spiritual record", D: "Latter-day testament", Correct: "B", Points: 20 },
        { id: 85, Category: "Church History", Question: "Which group of people did the Angel Moroni tell Joseph Smith the Book of Mormon was specifically written TO? (Title Page)", A: "The Nephites", B: "The Lamanites", C: "Europeans", D: "The islands of the sea", Correct: "B", Points: 20 },
        { id: 86, Category: "Church History", Question: "Which three ancient Apostles appeared to Joseph Smith and Oliver Cowdery to restore the Melchizedek Priesthood?", A: "Moses, Elias, and Elijah", B: "Peter, James, and John", C: "Abraham, Isaac, and Jacob", D: "Nephi, Alma, and Moroni", Correct: "B", Points: 20 },
        { id: 87, Category: "Church History", Question: "The event known as the First Vision took place in which forested area near Joseph Smith's home?", A: "The Sacred Grove", B: "The Wilderness of Nephi", C: "The Plains of Palmyra", D: "Cumorah's Hill", Correct: "A", Points: 20 },
        { id: 89, Category: "Church History", Question: "What was the last book in the Book of Mormon TRANSLATED by Joseph Smith?", A: "2 Nephi", B: "Moroni", C: "Ether", D: "Words of Mormon", Correct: "D", Points: 20 }
    ];

    // --- CONFIG ---
    const QUESTIONS_PER_ROUND = 4;

    // --- COLORS ---
    const CAT_COLORS = {
        "Scripture Mastery": "bg-blue-600 border-blue-400 text-white",
        "LDS Lifestyle": "bg-green-600 border-green-400 text-white",
        "Pop Culture": "bg-purple-600 border-purple-400 text-white",
        "Mission Prep": "bg-red-600 border-red-400 text-white",
        // UPDATED: Changed from yellow-600/yellow-400 (light) to amber-800/amber-600 (darker) to ensure white text visibility.
        "Church History": "bg-amber-800 border-amber-600 text-white", 
        "Default": "bg-gray-700 border-gray-500 text-white"
    };

    const TeamCard = ({ name, score, color, isActive, isStealing }) => (
        <div className={`relative flex flex-col items-center p-4 rounded-lg border-4 transition-all duration-300 
            ${isActive || isStealing ? 'scale-110 shadow-xl' : 'opacity-60 border-transparent scale-95'} 
            ${// UPDATED: Use white text for the amber team
                color === 'bg-amber-800 text-white' ? 'bg-amber-800' : 
                color === 'bg-yellow-500 text-black' ? 'bg-amber-700 text-white' : // Change team color 4
                color
            }
            ${isStealing ? 'border-white ring-4 ring-yellow-400' : ''}
            ${isActive && !isStealing ? 'border-white' : ''}
        `}>
            <div className="text-xl font-bold uppercase tracking-wider">{name}</div>
            <div className="text-4xl font-black mt-2">{score}</div>
            
            {isActive && !isStealing && (
                <div className="absolute -top-3 bg-white text-black px-3 py-1 rounded-full text-xs font-bold shadow animate-bounce">
                    YOUR TURN
                </div>
            )}
            {isStealing && (
                <div className="absolute -top-3 bg-yellow-400 text-black px-3 py-1 rounded-full text-xs font-bold shadow animate-pulse">
                    STEALING!
                </div>
            )}
        </div>
    );

    const App = () => {
        // --- STATE ---
        // setup, rules, category_select, quiz_active, finished
        const [gamePhase, setGamePhase] = React.useState('setup'); 
        
        const [teams, setTeams] = React.useState([
            { id: 0, name: "Team 1", score: 0, color: "bg-red-600" },
            { id: 1, name: "Team 2", score: 0, color: "bg-blue-600" },
            { id: 2, name: "Team 3", score: 0, color: "bg-green-600" },
            // UPDATED: Changed color class to a darker amber for better contrast
            { id: 3, name: "Team 4", score: 0, color: "bg-amber-700 text-white" } 
        ]);

        const [ownerTeamIdx, setOwnerTeamIdx] = React.useState(0);
        const [usedQuestionIds, setUsedQuestionIds] = React.useState([]);
        
        // Quiz State
        const [quizQueue, setQuizQueue] = React.useState([]);
        const [quizQIdx, setQuizQIdx] = React.useState(0);
        const [attemptOffset, setAttemptOffset] = React.useState(0); 
        const [showAnswer, setShowAnswer] = React.useState(false); // Only true when correct answer found OR all failed
        const [feedbackMsg, setFeedbackMsg] = React.useState(""); // "Wrong! Next Team..."
        const [isLocked, setIsLocked] = React.useState(false); // Prevents double clicks
        const [showConfirmModal, setShowConfirmModal] = React.useState(false); // New State for Modal
        
        // Timer State
        const [timeLeft, setTimeLeft] = React.useState(60);

        const currentAnsweringTeamIdx = (ownerTeamIdx + attemptOffset) % 4;
        const currentQuestion = quizQueue[quizQIdx];

        // --- LOGIC ---

        React.useEffect(() => {
            const saved = localStorage.getItem('triviaStateV12'); // NEW VERSION
            if (saved) {
                try {
                    const p = JSON.parse(saved);
                    let initialPhase = p.gamePhase;

                    // FIX: If the saved phase is 'rules' (the interstitial page),
                    // drop back to 'setup' so the user must click 'Start Game' again.
                    if (initialPhase === 'rules') {
                        initialPhase = 'setup';
                    }

                    setTeams(p.teams);
                    setOwnerTeamIdx(p.ownerTeamIdx);
                    setUsedQuestionIds(p.usedQuestionIds);
                    setGamePhase(initialPhase); // Use the corrected initialPhase
                    setQuizQueue(p.quizQueue);
                    setQuizQIdx(p.quizQIdx);
                    setAttemptOffset(p.attemptOffset);
                } catch (e) { console.error("Load failed", e); }
            }
        }, []);

        React.useEffect(() => {
            if (gamePhase !== 'setup') {
                localStorage.setItem('triviaStateV12', JSON.stringify({
                    teams, ownerTeamIdx, usedQuestionIds, gamePhase, quizQueue, quizQIdx, attemptOffset
                }));
            }
        }, [teams, ownerTeamIdx, usedQuestionIds, gamePhase, quizQueue, quizQIdx, attemptOffset]);

        // TIMER LOGIC
        React.useEffect(() => {
            if (gamePhase === 'quiz_active' && !showAnswer && !isLocked && timeLeft > 0) {
                const timerId = setTimeout(() => setTimeLeft(prev => prev - 1), 1000);
                return () => clearTimeout(timerId);
            } else if (timeLeft === 0 && !isLocked && gamePhase === 'quiz_active' && !showAnswer) {
                handleTimeUp();
            }
        }, [timeLeft, gamePhase, showAnswer, isLocked]);

        const handleTimeUp = () => {
            setIsLocked(true);
            setFeedbackMsg("Time's Up!");

            if (attemptOffset < 3) {
                // Steal available (Owner timed out, or Steal Team 1/2 timed out)
                setTimeout(() => {
                    setAttemptOffset(prev => prev + 1);
                    setTimeLeft(20); // Set time to 20s for steal attempt
                    setFeedbackMsg("");
                    setIsLocked(false);
                }, 1500);
            } else {
                // Last attempt (attemptOffset === 3) failed due to timeout. Skip reveal.
                setFeedbackMsg("All teams timed out! Moving to the next question.");
                setTimeout(() => nextQuestion(), 2000); 
            }
        };

        const startGame = () => setGamePhase('rules'); // Transition to rules page
        
        const resetGame = () => {
            // FIX: Removed window.confirm to ensure the reset button works reliably in all environments.
            localStorage.removeItem('triviaStateV12');
            window.location.reload();
        };

        const endGameEarly = () => {
            setShowConfirmModal(true);
        };
        
        const confirmEndGame = () => {
            setShowConfirmModal(false);
            setGamePhase('finished');
        };

        const toggleFullscreen = () => {
            const element = document.documentElement; // Target the whole HTML element

            if (document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement || document.msFullscreenElement) {
                // Exit fullscreen
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.mozCancelFullScreen) { // Firefox
                    document.mozCancelFullScreen();
                } else if (document.webkitExitFullscreen) { // Chrome, Safari and Opera
                    document.webkitExitFullscreen();
                } else if (document.msExitFullscreen) { // IE/Edge
                    document.msExitFullscreen();
                }
            } else {
                // Enter fullscreen
                if (element.requestFullscreen) {
                    element.requestFullscreen();
                } else if (element.mozRequestFullScreen) { // Firefox
                    element.mozRequestFullScreen();
                } else if (element.webkitRequestFullscreen) { // Chrome, Safari and Opera
                    element.webkitRequestFullscreen();
                } else if (element.msRequestFullscreen) { // IE/Edge
                    element.msRequestFullscreen();
                }
            }
        };

        const getCategories = () => {
            const counts = {};
            RAW_QUESTIONS.forEach(q => {
                if (!usedQuestionIds.includes(q.id)) {
                    counts[q.Category] = (counts[q.Category] || 0) + 1;
                }
            });
            return Object.entries(counts);
        };

        const selectCategory = (category) => {
            const available = RAW_QUESTIONS.filter(q => q.Category === category && !usedQuestionIds.includes(q.id));
            const shuffled = available.sort(() => 0.5 - Math.random()).slice(0, QUESTIONS_PER_ROUND); 
            
            if (shuffled.length === 0) return;

            setQuizQueue(shuffled);
            setQuizQIdx(0);
            setAttemptOffset(0);
            setShowAnswer(false);
            setFeedbackMsg("");
            setIsLocked(false);
            setTimeLeft(60); // Start timer
            setUsedQuestionIds(prev => [...prev, ...shuffled.map(q => q.id)]);
            setGamePhase('quiz_active');
        };

        const handleOptionClick = (key) => {
            if (isLocked || showAnswer) return;

            const isCorrect = key === currentQuestion.Correct;

            if (isCorrect) {
                // --- CORRECT ---
                setIsLocked(true);
                setShowAnswer(true); 
                setFeedbackMsg("Correct!");
                
                const newTeams = [...teams];
                newTeams[currentAnsweringTeamIdx].score += currentQuestion.Points;
                setTeams(newTeams);

                setTimeout(() => nextQuestion(), 2000);

            } else {
                // --- WRONG ---
                if (attemptOffset < 3) {
                    setIsLocked(true); 
                    setFeedbackMsg("WRONG! Next Team...");
                    
                    setTimeout(() => {
                        setAttemptOffset(prev => prev + 1);
                        
                        // Set time to 20s for steal attempt
                        setTimeLeft(20);

                        setFeedbackMsg("");
                        setIsLocked(false);
                    }, 1500);
                } else {
                    // Last team answered wrong. Reveal answer and wait for moderator to advance.
                    setShowAnswer(true);
                    setFeedbackMsg("All teams missed it!");
                }
            }
        };

        const nextQuestion = () => {
            if (quizQIdx < quizQueue.length - 1) {
                setQuizQIdx(prev => prev + 1);
                setAttemptOffset(0); 
                setShowAnswer(false);
                setFeedbackMsg("");
                setIsLocked(false);
                setTimeLeft(60); // Reset timer for new question
            } else {
                endQuizRound();
            }
        };

        const endQuizRound = () => {
            if (getCategories().length === 0) {
                 setGamePhase('finished');
            } else {
                setGamePhase('category_select');
                setOwnerTeamIdx(prev => (prev + 1) % 4);
                setQuizQueue([]);
            }
        };

        const updateTeamName = (idx, val) => {
            const newTeams = [...teams];
            newTeams[idx].name = val;
            setTeams(newTeams);
        }

        // --- VIEWS ---

        if (gamePhase === 'setup') {
            return (
                <div className="min-h-screen bg-slate-900 flex items-center justify-center p-4">
                    <div className="bg-slate-800 p-8 rounded-xl border border-slate-700 w-full max-w-md">
                        <h1 className="text-3xl font-bold text-center mb-6 bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-purple-500">Church Trivia Setup</h1>
                        <div className="space-y-4 mb-8">
                            {teams.map((t, i) => (
                                <div key={i} className="flex items-center gap-3">
                                    <div className={`w-6 h-6 rounded-full ${t.color}`}></div>
                                    <input className="flex-1 bg-slate-700 border-slate-600 rounded px-3 py-2 text-white" 
                                        value={t.name} onChange={e => updateTeamName(i, e.target.value)} />
                                </div>
                            ))}
                        </div>
                        <button onClick={startGame} className="w-full bg-green-600 hover:bg-green-500 text-white font-bold py-3 rounded">Start Game</button>
                    </div>
                </div>
            );
        }

        if (gamePhase === 'rules') {
            return (
                <div className="min-h-screen bg-slate-900 flex items-center justify-center p-4">
                    <div className="bg-slate-800 p-8 rounded-xl border border-slate-700 w-full max-w-2xl text-left animate-pop">
                        <h1 className="text-3xl font-bold text-center mb-6 text-white">Church Trivia Rules</h1>
                        <ol className="list-decimal list-inside space-y-4 text-slate-300 text-lg">
                            <li><span className="font-bold text-white">Category Selection:</span> The team whose score card says <span className="font-bold text-white">YOUR TURN</span> chooses a category to start a <span className="font-bold text-white">{QUESTIONS_PER_ROUND}-question quiz</span>.</li>
                            <li><span className="font-bold text-white">Point Values:</span> <span className="font-bold text-purple-400">Pop Culture questions are worth 10 points</span>. All other categories are worth <span className="font-bold text-white">20 points</span>.</li>
                            <li><span className="font-bold text-white">Answering Time:</span> The choosing team has <span className="font-bold text-white">60 seconds</span> to answer the question. If correct, they earn the points, and the quiz continues to the next question.</li>
                            <li><span className="font-bold text-white">Steal Attempt:</span> If a team answers <span className="font-bold text-white">Wrong</span> OR <span className="font-bold text-white">Time Runs Out</span>, the question is put up for a steal. The next team in the rotation (marked <span className="font-bold text-white">STEALING!</span>) gets <span className="font-bold text-white">20 seconds</span> to answer.</li>
                            <li><span className="font-bold text-white">Passing Steals:</span> If a stealing team misses (answers wrong or times out), the chance immediately passes to the next team in rotation with a fresh 20-second timer.</li>
                            <li><span className="font-bold text-white">All Miss/Timeout:</span> If <span className="font-bold text-white">all 4 teams run out of time</span>, the question is discarded, and the game automatically moves to the next question without revealing the answer.</li>
                            <li><span className="font-bold text-white">Last Team Misses:</span> If the <span className="font-bold text-white">final stealing team answers wrong</span> (before time runs out), the correct answer is revealed before moving to the next question.</li>
                            <li><span className="font-bold text-white">End of Round:</span> After the {QUESTIONS_PER_ROUND}-question quiz is finished, the privilege to choose the next category passes to the next team in rotation.</li>
                        </ol>
                        <button onClick={() => setGamePhase('category_select')} className="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 rounded mt-8">
                            Understood! Start Round 1
                        </button>
                        <button onClick={() => setGamePhase('setup')} className="w-full bg-transparent border border-slate-700 text-slate-400 font-bold py-2 rounded mt-4 hover:bg-slate-700">
                            Back to Setup
                        </button>
                    </div>
                </div>
            );
        }

        if (gamePhase === 'finished') {
            const sortedTeams = [...teams].sort((a,b) => b.score - a.score);
            const winner = sortedTeams[0];
            const isTie = sortedTeams.length > 1 && winner.score === sortedTeams[1].score;

            return (
                <div className="min-h-screen bg-slate-900 flex flex-col items-center justify-center p-6">
                    <div className="text-center animate-pop bg-slate-800 p-8 rounded-xl border border-slate-700 shadow-2xl w-full max-w-4xl">
                        <h1 className="text-5xl font-extrabold mb-4 text-transparent bg-clip-text bg-gradient-to-r from-yellow-300 to-yellow-500">
                            GAME OVER!
                        </h1>
                        
                        {/* Winner/Podium Display */}
                        <div className="mb-10 mt-10">
                            {isTie ? (
                                <h2 className="text-4xl text-white font-bold">It's a TIE!</h2>
                            ) : (
                                <>
                                    <p className="text-xl text-slate-300 mb-2">The Champions Are:</p>
                                    <div className={`inline-block p-6 rounded-2xl ${winner.color} animate-winner`}>
                                        <h2 className="text-6xl font-black uppercase text-white tracking-widest">
                                            {winner.name}
                                        </h2>
                                    </div>
                                </>
                            )}
                        </div>

                        {/* Leaderboard */}
                        <h3 className="text-2xl font-bold text-slate-300 mb-4">Final Leaderboard</h3>
                        <div className="space-y-3 w-full max-w-lg mx-auto">
                            {sortedTeams.map((t, i) => (
                                <div key={i} className={`flex justify-between items-center p-4 rounded-lg text-xl transition-all duration-300 ${i === 0 && !isTie ? 'bg-yellow-400 text-black font-black scale-105 shadow-xl' : 'bg-slate-700 text-white'}`}>
                                    <div className="flex items-center gap-4">
                                        <span className={`font-bold ${i === 0 && !isTie ? 'text-black' : 'text-slate-400'}`}>#{i+1}</span>
                                        <span>{t.name}</span>
                                    </div>
                                    <span className={`font-mono font-bold ${i === 0 && !isTie ? 'text-black' : 'text-green-400'}`}>{t.score} pts</span>
                                </div>
                            ))}
                        </div>

                        <button onClick={resetGame} className="mt-8 px-8 py-3 bg-red-600 hover:bg-red-500 text-white font-bold rounded">
                            Start New Game
                        </button>
                    </div>
                </div>
            );
        }

        return (
            <div className="min-h-screen flex flex-col bg-slate-900">
                
                {/* Scoreboard */}
                <div className="bg-slate-800 p-4 shadow-xl z-20">
                    <div className="max-w-6xl mx-auto grid grid-cols-4 gap-4">
                        {teams.map((t, i) => (
                            <TeamCard key={i} {...t} 
                                isActive={gamePhase !== 'finished' && i === ownerTeamIdx} 
                                isStealing={gamePhase === 'quiz_active' && i === currentAnsweringTeamIdx && i !== ownerTeamIdx}
                            />
                        ))}
                    </div>
                </div>

                {/* Main Content */}
                <div className="flex-1 flex flex-col items-center justify-center p-6 relative">
                    
                    {gamePhase === 'category_select' && (
                        <div className="animate-slide w-full max-w-4xl text-center">
                            <h2 className="text-4xl font-light text-slate-300 mb-8">
                                <span className="font-bold text-white">{teams[ownerTeamIdx].name}</span>, pick a category!
                            </h2>
                            
                            {/* UPDATED: Changed grid to 1 column on small screens, 2 columns (2x2) on medium and larger screens */}
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                {getCategories().map(([cat, count]) => (
                                    <button key={cat} onClick={() => selectCategory(cat)}
                                        className={`p-6 rounded-xl border-l-8 shadow-lg hover:scale-105 transition-transform text-left group ${CAT_COLORS[cat] || CAT_COLORS.Default}`}
                                    >
                                        <div className="text-2xl font-bold">{cat}</div>
                                        <div className="text-sm opacity-80 mt-1">{count} questions remaining</div>
                                    </button>
                                ))}
                            </div>
                            
                            {/* Control Buttons */}
                            <div className="mt-12 flex justify-center space-x-4">
                                
                                <button onClick={endGameEarly} className="px-6 py-2 bg-slate-700 text-red-400 rounded-lg font-bold hover:bg-slate-600 transition">
                                    End Game
                                </button>
                                
                                <button onClick={toggleFullscreen} className="px-6 py-2 bg-blue-700 text-white rounded-lg font-bold hover:bg-blue-600 transition">
                                    Toggle Fullscreen
                                </button>

                                {getCategories().length === 0 && (
                                    <button onClick={() => setGamePhase('finished')} className="px-8 py-3 bg-blue-600 rounded text-white font-bold">Show Final Results</button>
                                )}
                            </div>
                        </div>
                    )}

                    {gamePhase === 'quiz_active' && currentQuestion && (
                        <div className="w-full max-w-3xl animate-pop">
                            <div className="flex justify-between text-slate-400 mb-2 text-sm font-bold uppercase tracking-widest">
                                <span>Question {quizQIdx + 1} / {QUESTIONS_PER_ROUND}</span>
                                <span>{currentQuestion.Category}</span>
                            </div>
                            
                            <div className={`rounded-xl overflow-hidden border-2 shadow-2xl bg-white relative ${CAT_COLORS[currentQuestion.Category]}`}>
                                
                                {/* TIMER BAR */}
                                <div className="h-2 w-full bg-gray-200">
                                    <div 
                                        className={`h-full timer-bar ${
                                            timeLeft > 30 ? 'bg-green-500' : 
                                            timeLeft > 10 ? 'bg-yellow-500' : 'bg-red-600'
                                        }`} 
                                        style={{ width: `${Math.min((timeLeft / 60) * 100, 100)}%` }}
                                    ></div>
                                </div>

                                {/* FEEDBACK OVERLAY */}
                                {feedbackMsg && (
                                    <div className="absolute inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm animate-pop">
                                        <div className="bg-white text-black px-8 py-4 rounded-xl font-black text-3xl shadow-2xl transform rotate-[-2deg]">
                                            {feedbackMsg}
                                        </div>
                                    </div>
                                )}

                                {/* Header */}
                                <div className="bg-white border-b border-slate-200 p-4 flex justify-between items-center text-slate-800">
                                    <div className="flex items-center gap-2">
                                        {attemptOffset > 0 && (
                                            <span className="bg-red-500 text-white text-xs px-2 py-1 rounded animate-pulse">STEAL ATTEMPT</span>
                                        )}
                                        <span className="font-medium">Answering: {teams[currentAnsweringTeamIdx].name}</span>
                                    </div>
                                    <div className="flex items-center gap-4">
                                        <div className="font-mono text-xl font-bold flex items-center gap-1">
                                            <span>⏱</span> {timeLeft}s
                                        </div>
                                        <span className="bg-slate-200 px-3 py-1 rounded font-mono font-bold text-slate-800">{currentQuestion.Points} pts</span>
                                    </div>
                                </div>

                                {/* Question */}
                                <div className="p-8 md:p-12 text-slate-800 text-center">
                                    <h3 className="text-2xl md:text-3xl font-bold leading-snug mb-8">
                                        {currentQuestion.Question}
                                    </h3>
                                    
                                    {/* Options */}
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-3 text-left">
                                        {['A','B','C','D'].filter(k => currentQuestion[k]).map(key => {
                                            const isCorrectOption = key === currentQuestion.Correct;
                                            let btnClass = "bg-white border-slate-200 hover:border-blue-500 hover:bg-blue-50 text-slate-600";
                                            
                                            // Logic for reveal
                                            if (showAnswer) {
                                                if (isCorrectOption) btnClass = "bg-green-100 border-green-500 text-green-900";
                                                else btnClass = "bg-gray-50 border-slate-100 text-gray-300 opacity-50";
                                            }

                                            return (
                                                <button key={key}
                                                    disabled={isLocked || showAnswer}
                                                    onClick={() => handleOptionClick(key)}
                                                    className={`p-4 rounded border-2 text-lg font-medium transition-all ${btnClass}`}
                                                >
                                                    <span className="font-bold mr-2">{key}.</span> {currentQuestion[key]}
                                                </button>
                                            );
                                        })}
                                    </div>
                                </div>

                                {/* Footer Control for All-Fail State (Only appears if the last team answers WRONG) */}
                                {showAnswer && attemptOffset === 3 && (
                                    <div className="p-4 bg-slate-100 border-t border-slate-200 text-center">
                                        <p className="mb-2 font-bold text-slate-700">Correct Answer: {currentQuestion.Correct} - {currentQuestion[currentQuestion.Correct]}</p>
                                        <button onClick={nextQuestion} className="px-8 py-3 bg-slate-700 text-white rounded font-bold hover:bg-slate-600">
                                            Next Question &rarr;
                                        </button>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}
                    
                    {/* End Game Confirmation Modal */}
                    {showConfirmModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-70 z-50 flex items-center justify-center animate-pop">
                            <div className="bg-slate-700 p-8 rounded-xl w-full max-w-sm text-center shadow-2xl border-2 border-red-500">
                                <h3 className="text-2xl font-bold mb-4 text-red-400">Are you sure?</h3>
                                <p className="text-slate-300 mb-6">Ending the game now will determine the winner based on current scores.</p>
                                <div className="flex justify-center space-x-4">
                                    <button onClick={() => setShowConfirmModal(false)} className="px-6 py-2 bg-blue-600 hover:bg-blue-500 text-white font-bold rounded">
                                        No, Continue Playing
                                    </button>
                                    <button onClick={confirmEndGame} className="px-6 py-2 bg-red-600 hover:bg-red-500 text-white font-bold rounded">
                                        Yes, End Game
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    <button onClick={resetGame} className="fixed bottom-4 right-4 text-xs text-slate-600 hover:text-red-500">Reset Game</button>
                </div>
            </div>
        );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);

</script>
</body>
</html>
